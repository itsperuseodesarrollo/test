!function(w){w.fn.extend({autocomplete:function(e,t){var a="string"==typeof e;return(t=w.extend({},w.Autocompleter.defaults,{url:a?e:null,data:a?null:e,delay:a?w.Autocompleter.defaults.delay:10,max:t&&!t.scroll?10:150},t)).highlight=t.highlight||function(e){return e},t.formatMatch=t.formatMatch||t.formatItem,this.each(function(){new w.Autocompleter(this,t)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),w.Autocompleter=function(i,o){var t,r,a,l={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},s=w(i).attr("autocomplete","off").addClass(o.inputClass),u="",c=w.Autocompleter.Cache(o),f=0,e={mouseDownOnSelect:!1},h=w.Autocompleter.Select(o,i,n,e);function n(){var e=h.selected();if(!e)return!1;var t=e.result;if(u=t,o.multiple){var a=d(s.val());1<a.length&&(t=a.slice(0,a.length-1).join(o.multipleSeparator)+o.multipleSeparator+t),t+=o.multipleSeparator}return s.val(t),g(),s.trigger("result",[e.data,e.value]),!0}function p(e,t){if(r!=l.DEL){var a=s.val();(t||a!=u)&&((a=m(u=a)).length>=o.minChars?(s.addClass(o.loadingClass),o.matchCase||(a=a.toLowerCase()),C(a,v,g)):(b(),h.hide()))}else h.hide()}function d(e){if(!e)return[""];var t=e.split(o.multipleSeparator),a=[];return w.each(t,function(e,t){w.trim(t)&&(a[e]=w.trim(t))}),a}function m(e){if(!o.multiple)return e;var t=d(e);return t[t.length-1]}function g(){h.visible();h.hide(),clearTimeout(t),b(),o.mustMatch&&s.search(function(e){if(!e)if(o.multiple){var t=d(s.val()).slice(0,-1);s.val(t.join(o.multipleSeparator)+(t.length?o.multipleSeparator:""))}else s.val("")})}function v(e,t){var a,n;t&&t.length&&f?(b(),h.display(t,e),a=e,n=t[0].value,o.autoFill&&m(s.val()).toLowerCase()==a.toLowerCase()&&r!=l.BACKSPACE&&(s.val(s.val()+n.substring(m(u).length)),w.Autocompleter.Selection(i,u.length,u.length+n.length)),h.show()):g()}function C(a,n,e){o.matchCase||(a=a.toLowerCase());var t=c.load(a);if(t&&t.length)n(a,t);else if("string"==typeof o.url&&0<o.url.length){var r={timestamp:+new Date};w.each(o.extraParams,function(e,t){r[e]="function"==typeof t?t():t}),w.ajax({mode:"abort",port:"autocomplete"+i.name,dataType:o.dataType,url:o.url,data:w.extend({q:m(a),limit:o.max},r),success:function(e){if(e){var t=o.parse&&o.parse(e)||function(e){for(var t=[],a=e.split("\n"),n=0;n<a.length;n++){var r=w.trim(a[n]);r&&(r=r.split("|"),t[t.length]={data:r,value:r[0],result:o.formatResult&&o.formatResult(r,r[0])||r[0]})}return t}(e);c.add(a,t),n(a,t)}}})}else h.emptyList(),e(a)}function b(){s.removeClass(o.loadingClass)}w.browser.opera&&w(i.form).bind("submit.autocomplete",function(){if(a)return a=!1}),s.bind((w.browser.opera?"keypress":"keydown")+".autocomplete",function(e){switch(r=e.keyCode,e.keyCode){case l.UP:e.preventDefault(),h.visible()?h.prev():p(0,!0);break;case l.DOWN:e.preventDefault(),h.visible()?h.next():p(0,!0);break;case l.PAGEUP:e.preventDefault(),h.visible()?h.pageUp():p(0,!0);break;case l.PAGEDOWN:e.preventDefault(),h.visible()?h.pageDown():p(0,!0);break;case o.multiple&&","==w.trim(o.multipleSeparator)&&l.COMMA:case l.TAB:case l.RETURN:if(n())return e.preventDefault(),!(a=!0);break;case l.ESC:h.hide();break;default:clearTimeout(t),t=setTimeout(p,o.delay)}}).focus(function(){f++}).blur(function(){f=0,e.mouseDownOnSelect||(clearTimeout(t),t=setTimeout(g,200))}).click(function(){1<f++&&!h.visible()&&p(0,!0)}).bind("search",function(){var r=1<arguments.length?arguments[1]:null;function a(e,t){var a;if(t&&t.length)for(var n=0;n<t.length;n++)if(t[n].result.toLowerCase()==e.toLowerCase()){a=t[n];break}"function"==typeof r?r(a):s.trigger("result",a&&[a.data,a.value])}w.each(d(s.val()),function(e,t){C(t,a,a)})}).bind("flushCache",function(){c.flush()}).bind("setOptions",function(){w.extend(o,arguments[1]),"data"in arguments[1]&&c.populate()}).bind("unautocomplete",function(){h.unbind(),s.unbind(),w(i.form).unbind(".autocomplete")})},w.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180,appendResultsTo:document.body},w.Autocompleter.Cache=function(s){var i={},o=0;function l(e,t){s.matchCase||(e=e.toLowerCase());var a=e.indexOf(t);return"word"==s.matchContains&&(a=e.toLowerCase().search("\\b"+t.toLowerCase())),-1!=a&&(0==a||s.matchContains)}function u(e,t){o>s.cacheLength&&a(),i[e]||o++,i[e]=t}function e(){if(!s.data)return!1;var e={},t=0;s.url||(s.cacheLength=1),e[""]=[];for(var a=0,n=s.data.length;a<n;a++){var r=s.data[a];r="string"==typeof r?[r]:r;var i=s.formatMatch(r,a+1,s.data.length);if(!1!==i){var o=i.charAt(0).toLowerCase();e[o]||(e[o]=[]);var l={value:i,data:r,result:s.formatResult&&s.formatResult(r)||i};e[o].push(l),t++<s.max&&e[""].push(l)}}w.each(e,function(e,t){s.cacheLength++,u(e,t)})}function a(){i={},o=0}return setTimeout(e,25),{flush:a,add:u,populate:e,load:function(a){if(!s.cacheLength||!o)return null;if(!s.url&&s.matchContains){var n=[];for(var e in i)if(0<e.length){var t=i[e];w.each(t,function(e,t){l(t.value,a)&&n.push(t)})}return n}if(i[a])return i[a];if(s.matchSubset)for(var r=a.length-1;r>=s.minChars;r--){if(t=i[a.substr(0,r)]){n=[];return w.each(t,function(e,t){l(t.value,a)&&(n[n.length]=t)}),n}}return null}}},w.Autocompleter.Select=function(i,n,a,r){var o,l,s,u,c="ac_over",f=-1,h="",p=!0;function d(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function e(e){o.slice(f,f+1).removeClass(c),(f+=e)<0?f=o.size()-1:f>=o.size()&&(f=0);var t=o.slice(f,f+1).addClass(c);if(i.scroll){var a=0;o.slice(0,f).each(function(){a+=this.offsetHeight}),a+t[0].offsetHeight-u.scrollTop()>u[0].clientHeight?u.scrollTop(a+t[0].offsetHeight-u.innerHeight()):a<u.scrollTop()&&u.scrollTop(a)}}function m(){u.empty();for(var e,t=(e=l.length,i.max&&i.max<e?i.max:e),a=0;a<t;a++)if(l[a]){var n=i.formatItem(l[a].data,a+1,t,l[a].value,h);if(!1!==n){var r=w("<li/>").html(i.highlight(n,h)).addClass(a%2==0?"ac_even":"ac_odd").appendTo(u)[0];w.data(r,"ac_data",l[a])}}o=u.find("li"),i.selectFirst&&(o.slice(0,1).addClass(c),f=0),w.fn.bgiframe&&u.bgiframe()}return{display:function(e,t){p&&(s=w("<div/>").hide().addClass(i.resultsClass).css("position","absolute").appendTo(i.appendResultsTo),u=w("<ul/>").appendTo(s).mouseover(function(e){d(e).nodeName&&"LI"==d(e).nodeName.toUpperCase()&&(f=w("li",u).removeClass(c).index(d(e)),w(d(e)).addClass(c))}).click(function(e){return w(d(e)).addClass(c),a(),n.focus(),!1}).mousedown(function(){r.mouseDownOnSelect=!0}).mouseup(function(){r.mouseDownOnSelect=!1}),0<i.width&&s.css("width",i.width),p=!1),l=e,h=t,m()},next:function(){e(1)},prev:function(){e(-1)},pageUp:function(){e(0!=f&&f-8<0?-f:-8)},pageDown:function(){f!=o.size()-1&&f+8>o.size()?e(o.size()-1-f):e(8)},hide:function(){s&&s.hide(),o&&o.removeClass(c),f=-1},visible:function(){return s&&s.is(":visible")},current:function(){return this.visible()&&(o.filter("."+c)[0]||i.selectFirst&&o[0])},show:function(){var e=w(n).offset();if(s.css({width:"string"==typeof i.width||0<i.width?i.width:w(n).innerWidth(),top:e.top+n.offsetHeight,left:e.left}).show(),i.scroll&&(u.scrollTop(0),u.css({maxHeight:i.scrollHeight,overflow:"auto"}),w.browser.msie&&void 0===document.body.style.maxHeight)){var t=0;o.each(function(){t+=this.offsetHeight});var a=t>i.scrollHeight;u.css("height",a?i.scrollHeight:t),a||o.width(u.width()-parseInt(o.css("padding-left"))-parseInt(o.css("padding-right")))}},selected:function(){var e=o&&o.filter("."+c).removeClass(c);return e&&e.length&&w.data(e[0],"ac_data")},emptyList:function(){u&&u.empty()},unbind:function(){s&&s.remove()}}},w.Autocompleter.Selection=function(e,t,a){if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveStart("character",t),n.moveEnd("character",a),n.select()}else e.setSelectionRange?e.setSelectionRange(t,a):e.selectionStart&&(e.selectionStart=t,e.selectionEnd=a);e.focus()}}(jQuery);